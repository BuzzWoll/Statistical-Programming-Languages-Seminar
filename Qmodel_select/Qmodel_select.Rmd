---
title: "Qmodel_select"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{R}
# Model selection
# provides a data.frame to store the results of the model selection process
#library("dynlm")
model_select = data.frame(t(c(0,0,0,0)))
names(model_select) = c("DF", "lags", "AR", "BIC")

for(i in 1:5){
  for(j in 1:8){
    for(l in 1:9){
      diff_2 = ifelse(i > 1,1,0) * diff_index[,2] 
      diff_3 = ifelse(i > 2,1,0) * diff_index[,3] 
      diff_4 = ifelse(i > 3,1,0) * diff_index[,4] 
      diff_5 = ifelse(i > 4,1,0) * diff_index[,5]
      ar_y = ifelse(l < 2, 0, 1) * y.sample
     
      model = lm(y.sample ~ lag(diff_index[,1],k=c(1:j)) + 
                            lag(ar_y, k=c(1:(l-1))) +
                            lag(diff_2,k=c(1:j)) +
                            lag(diff_3,k=c(1:j)) +
                            lag(diff_4,k=c(1:j)) +
                            lag(diff_5,k=c(1:j)), 
                            na.action = na.omit)

      bic = BIC(model)
      # append this to dataframe
      model_select = rbind(model_select, c(i,j,(l-1), round(bic,2)))
    }
  }
}
# print the full line of the optimal DI model
DI_model_select = model_select[which(model_select$BIC == min(model_select[model_select$AR == 0,"BIC"])),]
DI_model_select

# print the full line of the optimal DI-AR model
DI_AR_model_select = model_select[which(model_select$BIC == min(model_select[model_select$AR > 0,"BIC"])),]
DI_AR_model_select

```
