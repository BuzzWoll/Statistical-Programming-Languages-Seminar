---
title: "Qpca"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library("MASS")
load("../Qprepare/prepareddata.RData")


# Format data into POSIXct 
train[,1] = as.POSIXct(train[,1])
end_date = as.POSIXct("2015-01-01")
# Only use data until december 2014 to select the model
x = train[train$date < end_date,]
y = x$`S&P500`

pca_data = prcomp(x[,-1],
                  center = T,
                  scale. = T)

summary(pca_data)
plot(pca_data, type = "l")

# Model selection

#gets the first three PCAs
z = as.matrix(pca_data$rotation[,1:10])
# get rid of the data column
x = as.matrix(x[,-1])

diff_index = x %*% z
a = lm(y ~ 0 + lag(diff_index[,1],-1) + lag(diff_index[,2],-1) + lag(diff_index[,3],-1) + lag(diff_index[,4],-1) + lag(diff_index[,5],-1) + lag(diff_index[,6],-1) + lag(diff_index[,7],-1) + lag(diff_index[,8],-1) + lag(diff_index[,9],-1) + lag(diff_index[,10],-1))
b = lm(y ~ 0 + lag(y,12))
summary(b)
y[1:10]

summary(a)

plot(x[,1],y, type = "l") + abline(b, col="red")

BIC(a)

```


```{r}
pca_data = prcomp(subset(train[,-1],),
                  center = T,
                  scale. = T)

predict.prcomp()
```

