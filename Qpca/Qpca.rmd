---
title: "Qpca"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library("MASS")
library("xts")
load("../Qprepare/prepareddata.RData")
load("../Qprepare/prepareddataSC.RData")

# first row of train only contains zeros!
train = unscaled_train

# Format data into POSIXct 
train[,1] = as.POSIXct(train[,1])
dates = train[,1]

# probably unnecessary!!!
end_date = as.POSIXct("2015-01-01 01:00:00 CET")
last_known_data = which(dates == end_date)-1
origin = "1970-01-01 00:00:00"

x_raw = xts(train[,-1], order.by = train[,1])
# Only use data until december 2014 to select the model
x.sample = x_raw['/2014-12-01']
y.sample = (x.sample$`S&P500`)


#Extract PCAs
pca_data = prcomp(x.sample,
                  center = T,
                  scale. = T)

summary(pca_data)
plot(pca_data, type = "l")

diff_index = xts(pca_data$x[,1:5], order.by = dates[1:273])

save(diff_index, file = "diff_index.RData")
save(x.sample, file = "x.sample.RData")
save(y.sample, file = "y.sample.RData")
```